<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2NQ6TTY12L"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-2NQ6TTY12L');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2Q1 Timetable - Semester IV</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg: #0a0a0a;
            --surface: #141414;
            --surface-2: #1a1a1a;
            --surface-3: #222222;
            --border: #262626;
            --border-light: #333333;
            --text: #fafafa;
            --text-muted: #737373;
            --text-secondary: #a3a3a3;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --green: #059669;
            --green-light: #10b981;
            --purple: #8b5cf6;
            --orange: #f59e0b;
            --red: #dc2626;
            --red-light: #ef4444;
        }

        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: var(--bg); 
            min-height: 100vh; 
            color: var(--text);
        }

        /* ==================== LANDING PAGE ==================== */
        .landing-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            position: relative;
        }

        .landing-content {
            text-align: center;
            max-width: 600px;
        }

        .logo-text {
            font-size: 0.75rem;
            letter-spacing: 0.3em;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 24px;
        }

        .main-title {
            font-size: clamp(2.5rem, 8vw, 4rem);
            font-weight: 700;
            letter-spacing: -0.03em;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #fff 0%, #737373 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-size: 1rem;
            color: var(--text-muted);
            margin-bottom: 48px;
            font-weight: 400;
        }

        .semester-tag {
            display: inline-block;
            padding: 6px 12px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 100px;
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 48px;
            letter-spacing: 0.05em;
        }

        .section-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin-bottom: 32px;
        }

        .section-btn {
            padding: 20px 16px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .section-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--accent) 0%, var(--purple) 100%);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .section-btn:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .section-btn:hover::before {
            opacity: 0.1;
        }

        .section-btn span {
            position: relative;
            z-index: 1;
        }

        .section-btn small {
            display: block;
            font-size: 0.65rem;
            color: var(--text-muted);
            font-weight: 400;
            margin-top: 4px;
            position: relative;
            z-index: 1;
        }

        /* ==================== NEW ASTHETIC BUTTON STYLE ==================== */
.resource-hub-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    width: 100%;
    max-width: 420px;
    margin: 0 auto 48px auto;
    padding: 22px 28px;
    
    /* DARK THEME: Matches your Section Buttons */
    background: var(--surface); 
    border: 1px solid var(--border);
    border-radius: 16px;
    color: var(--text);
    
    font-size: 1.05rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    
    /* Subtle shadow instead of heavy glow */
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

/* The "Glow" Effect (Hidden by default, visible on Hover) */
.resource-hub-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, var(--accent) 0%, var(--purple) 100%);
    opacity: 0; /* Hidden */
    transition: opacity 0.3s ease;
    z-index: 0;
}

/* Hover State */
.resource-hub-btn:hover {
    border-color: var(--purple); /* Purple border on hover */
    transform: translateY(-2px);
    box-shadow: 0 10px 30px -10px rgba(139, 92, 246, 0.5); /* Soft purple glow */
}

.resource-hub-btn:hover::before {
    opacity: 0.1; /* Shows the gradient faintly inside */
}

/* Ensure text stays on top */
.resource-hub-btn svg,
.resource-hub-btn span,
.live-dot,
.resource-badge {
    position: relative;
    z-index: 2;
}

/* Update the Icon Color */
.resource-hub-btn svg {
    width: 24px;
    height: 24px;
    color: var(--text-muted); /* Grey icon by default */
    transition: color 0.3s ease;
}

.resource-hub-btn:hover svg {
    color: var(--purple); /* Turns purple on hover */
}

/* New Minimalist "Live" Badge */
.resource-badge {
    background: rgba(16, 185, 129, 0.1); /* Very subtle green bg */
    color: var(--green-light);
    border: 1px solid rgba(16, 185, 129, 0.2);
    padding: 4px 10px;
    border-radius: 100px;
    font-size: 0.7rem;
    font-weight: 600;
    margin-left: auto; /* Pushes badge to the far right */
}

        /* Footer */
        .footer-credit {
            position: absolute;
            bottom: 30px;
            left: 0;
            right: 0;
            font-size: 0.8rem;
            color: var(--text-muted);
            letter-spacing: 0.05em;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            z-index: 10;
        }

        .footer-credit a {
            text-decoration: none;
            font-size: 1.4rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            font-family: 'Inter', sans-serif;
            background: linear-gradient(90deg, #978686, #564d4d, #e9eff9, #b18585);
            background-size: 300%;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            animation: shimmer 5s infinite linear;
        }

        .insta-icon {
            width: 18px;
            height: 18px;
            fill: #737373;
            transition: all 0.3s ease;
            margin-bottom: 2px;
        }

        .footer-credit a:hover {
            transform: scale(1.05);
        }

        .footer-credit a:hover .insta-icon {
            fill: #e9eff9;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
        }

        @keyframes shimmer {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        /* ==================== RESOURCE HUB PAGE ==================== */
        .resource-page {
            display: none;
            min-height: 100vh;
            padding: 30px 20px;
            background: var(--bg);
        }

        .resource-page.active {
            display: block;
        }

        .resource-header {
            max-width: 900px;
            margin: 0 auto 30px auto;
            text-align: center;
        }

        /* ==================== UNIFIED TITLE STYLE ==================== */
.resource-header h1 {
    font-size: clamp(2rem, 5vw, 2.5rem); /* Responsive size */
    font-weight: 700;
    letter-spacing: -0.03em;
    margin-bottom: 8px;
    
    /* The "2Q1 Timetable" Gradient Style */
    background: linear-gradient(135deg, #fff 0%, #737373 100%);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    
    /* Optional: Slight drop shadow for depth */
    filter: drop-shadow(0 2px 10px rgba(0,0,0,0.2));
}

/* Also update the icon next to it (if you add one later) */
.resource-header h1 svg {
    color: #fff; /* Reset icon color if needed */
}

        .resource-header p {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            background: var(--surface);
            border-radius: 20px;
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 12px;
        }

        .connection-status .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--green);
        }

        .connection-status.offline .dot {
            background: var(--red);
        }

        /* ==================== STEALTH TAB STYLE ==================== */
.tab-nav {
    display: flex;
    justify-content: center;
    gap: 16px; /* A bit more space between buttons */
    margin-bottom: 32px;
}

.tab-btn {
    padding: 12px 24px;
    
    /* Dark Base Style (The "Black/White Mix") */
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    
    /* Text starts muted (Grey) */
    color: var(--text-muted);
    font-size: 0.95rem;
    font-weight: 500;
    
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    
    display: flex;
    align-items: center;
    gap: 10px;
    position: relative;
    overflow: hidden;
}

/* Hover State: The "Blue Glow" appears */
.tab-btn:hover {
    border-color: var(--accent); /* Blue Border */
    color: white;                /* White Text */
    transform: translateY(-2px);
    
    /* The Glow */
    box-shadow: 0 0 15px rgba(59, 130, 246, 0.4); 
}

/* Active State: Stays lit up */
.tab-btn.active {
    background: var(--surface);  /* Keep background dark */
    border-color: var(--accent); /* Blue Border */
    color: white;                /* White Text */
    
    /* Stronger Glow for the active tab */
    box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
}

/* Icon Styling */
.tab-btn svg {
    width: 18px;
    height: 18px;
    transition: all 0.3s ease;
    opacity: 0.6;
}

/* Icon lights up on Hover/Active */
.tab-btn:hover svg,
.tab-btn.active svg {
    opacity: 1;
    color: var(--accent); /* Icon turns Blue */
    filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.6)); /* Icon glows too */
}

        /* Subject Filter */
        .subject-filter {
            max-width: 900px;
            margin: 0 auto 24px auto;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        .subject-chip {
            padding: 8px 16px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 20px;
            color: var(--text-muted);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .subject-chip:hover {
            border-color: var(--accent);
            color: var(--text);
        }

        .subject-chip.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        /* Resource List */
        .resource-list {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .resource-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            gap: 16px;
            transition: all 0.2s ease;
        }

        .resource-card:hover {
            border-color: var(--border-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .resource-card.reported {
            opacity: 0.5;
            border-color: var(--red);
        }

        /* Vote Section */
        .vote-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            min-width: 50px;
        }

        .vote-btn {
            width: 36px;
            height: 28px;
            background: var(--surface-2);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .vote-btn:hover {
            background: var(--surface-3);
            border-color: var(--border-light);
        }

        .vote-btn.upvote:hover, .vote-btn.upvote.active {
            background: var(--green);
            border-color: var(--green);
            color: white;
        }

        .vote-btn.downvote:hover, .vote-btn.downvote.active {
            background: var(--red);
            border-color: var(--red);
            color: white;
        }

        .vote-btn svg {
            width: 16px;
            height: 16px;
        }

        .vote-count {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text);
            padding: 4px 0;
        }

        .vote-count.positive { color: var(--green-light); }
        .vote-count.negative { color: var(--red-light); }

        /* Resource Content */
        .resource-content {
            flex: 1;
            min-width: 0;
        }

        .resource-title-row {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 8px;
        }

        .resource-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .resource-title a {
            color: var(--text);
            text-decoration: none;
            transition: color 0.2s;
        }

        .resource-title a:hover {
            color: var(--accent);
        }

        .external-icon {
            width: 14px;
            height: 14px;
            color: var(--text-muted);
            flex-shrink: 0;
        }

        .report-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .report-btn:hover {
            color: var(--red);
            background: rgba(220, 38, 38, 0.1);
        }

        .report-btn.reported {
            color: var(--red);
        }

        .report-btn svg {
            width: 16px;
            height: 16px;
        }

        .resource-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 8px;
        }

        .meta-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.72rem;
            color: var(--text-muted);
            background: var(--surface-2);
            padding: 4px 10px;
            border-radius: 6px;
        }

        .meta-tag.platform {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent);
        }

        .meta-tag.type {
            background: rgba(139, 92, 246, 0.15);
            color: var(--purple);
        }

        .rating-stars {
            display: inline-flex;
            gap: 1px;
        }

        .rating-stars svg {
            width: 11px;
            height: 11px;
        }

        .rating-stars svg.filled {
            fill: var(--orange);
            color: var(--orange);
        }

        .rating-stars svg.empty {
            fill: var(--border);
            color: var(--border);
        }

        .resource-subject {
            font-size: 0.72rem;
            color: var(--text-muted);
        }

        /* Loading & Empty States */
        .loading-state, .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: var(--text);
        }

        /* ==================== ADD RESOURCE FORM ==================== */
        .add-form-container {
            max-width: 600px;
            margin: 0 auto;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 32px;
        }

        .form-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 24px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text);
            margin-bottom: 8px;
        }

        .form-label span {
            color: var(--text-muted);
            font-weight: 400;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px 16px;
            background: var(--surface-2);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .form-input.error {
            border-color: var(--red);
        }

        .form-select {
            cursor: pointer;
        }

        .form-select option {
            background: var(--surface-2);
            color: var(--text);
        }

        .form-hint {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 6px;
        }

        .form-error {
            font-size: 0.75rem;
            color: var(--red);
            margin-top: 6px;
        }

        /* Star Rating Input */
        .star-rating-input {
            display: flex;
            gap: 8px;
        }

        .star-btn {
            width: 36px;
            height: 36px;
            background: var(--surface-2);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .star-btn:hover, .star-btn.active {
            background: var(--orange);
            border-color: var(--orange);
        }

        .star-btn svg {
            width: 18px;
            height: 18px;
            color: var(--text-muted);
        }

        .star-btn:hover svg, .star-btn.active svg {
            color: white;
            fill: white;
        }

        .rating-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 6px;
        }

        /* ==================== STEALTH BLUE SUBMIT BUTTON ==================== */
.submit-btn {
    width: 100%;
    padding: 18px 24px;
    margin-top: 24px;
    
    /* Dark Base (Black/Grey Mix) */
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    
    /* "Silver" Text Style */
    color: #d4d4d4; /* Light Silver */
    font-size: 1.05rem;
    font-weight: 600;
    letter-spacing: 0.02em;
    
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    position: relative;
    overflow: hidden;
}

/* HOVER STATE: Blue Power Up */
.submit-btn:hover:not(:disabled) {
    border-color: var(--accent);   /* Electric Blue Border */
    color: white;                  /* Bright White Text */
    background: rgba(59, 130, 246, 0.05); /* Faint Blue Tint */
    
    transform: translateY(-2px);
    
    /* The Blue Neon Glow */
    box-shadow: 0 0 25px -5px rgba(59, 130, 246, 0.4);
}

/* Add a subtle shine effect on hover */
.submit-btn:hover:not(:disabled)::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    animation: shine 0.5s ease forwards;
}

@keyframes shine {
    to { left: 100%; }
}

/* DISABLED STATE */
.submit-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: var(--surface-2);
}

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--surface-2);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 24px;
            color: var(--text);
            font-size: 0.9rem;
            z-index: 1000;
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            max-width: 90%;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .toast.success { border-color: var(--green); }
        .toast.error { border-color: var(--red); }
        .toast.warning { border-color: var(--orange); }

        /* Back Button */
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 16px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .back-btn:hover {
            background: var(--surface-2);
            transform: translateX(-2px);
        }

        /* ==================== TIMETABLE PAGE ==================== */
        .timetable-page {
            display: none;
            padding: 30px 20px;
            background: #fafafa;
            min-height: 100vh;
        }

        .timetable-page.active {
            display: block;
        }

        .landing-page.hidden, .resource-page.hidden {
            display: none;
        }

        .timetable-page .back-btn {
            background: #1a1a1a;
            border: none;
            color: white;
        }

        .timetable-page .back-btn:hover {
            background: #333;
        }

        /* Timetable Styles */
        .controls { display: flex; justify-content: center; align-items: center; gap: 16px; margin-bottom: 30px; flex-wrap: wrap; }
        .today-btn, .week-btn, .download-btn { padding: 12px 24px; border: 2px solid #3b82f6; background: white; color: #3b82f6; border-radius: 8px; font-weight: 600; font-size: 0.9rem; cursor: pointer; transition: all 0.2s ease; }
        .download-btn { border-color: #8b5cf6; color: #8b5cf6; }
        .today-btn.active, .week-btn.active { background: #3b82f6; color: white; }
        .download-btn:hover { background: #8b5cf6; color: white; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3); }
        .download-btn.downloading { background: #8b5cf6; color: white; pointer-events: none; opacity: 0.7; }
        .today-btn:hover, .week-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); }
        .current-time { background: #1a1a1a; color: white; padding: 8px 16px; border-radius: 6px; font-size: 0.85rem; font-weight: 500; font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace; }
        
        .today-agenda { max-width: 1200px; margin: 0 auto 30px auto; background: white; border-radius: 12px; padding: 24px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); border: 1px solid #e5e5e5; }
        .today-agenda h3 { margin-bottom: 20px; color: #1a1a1a; font-size: 1.3rem; font-weight: 600; }
        .agenda-content { display: flex; flex-direction: column; gap: 12px; }
        .agenda-item { display: flex; align-items: center; padding: 16px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3b82f6; transition: all 0.2s ease; }
        .agenda-item.current { border-left-color: #dc2626; background: #fef2f2; box-shadow: 0 2px 8px rgba(220, 38, 38, 0.2); }
        .agenda-item.next { border-left-color: #059669; background: #f0fdf4; }
        .agenda-item.lab { border-left-color: #059669; }
        .agenda-item.completed { border-left-color: #6b7280; background: #f9fafb; opacity: 0.8; }
        .agenda-time { font-weight: 600; color: #1a1a1a; min-width: 80px; font-size: 0.9rem; }
        .agenda-details { flex: 1; margin-left: 16px; }
        .agenda-course { font-weight: 600; color: #1a1a1a; margin-bottom: 4px; }
        .agenda-meta { font-size: 0.8rem; color: #6b7280; }
        .agenda-status { font-size: 0.75rem; padding: 4px 8px; border-radius: 4px; font-weight: 500; }
        .agenda-status.current { background: #dc2626; color: white; }
        .agenda-status.next { background: #059669; color: white; }
        .agenda-status.upcoming { background: #e5e5e5; color: #6b7280; }
        .agenda-status.completed { background: #6b7280; color: white; }
        .no-classes { text-align: center; color: #6b7280; font-size: 1.1rem; padding: 40px; }
        .hidden { display: none; }
        
        .timetable-container.today-mode .cell:not(.today-column), .timetable-container.today-mode .header:not(.today-column) { opacity: 0.3; pointer-events: none; }
        .timetable-container.today-mode .time-slot { opacity: 1; }
        
        h1.page-title { text-align: center; color: #1a1a1a; font-size: 2.5rem; font-weight: 600; margin-bottom: 10px; letter-spacing: -0.02em; }
        .semester-badge { text-align: center; margin-bottom: 30px; }
        .semester-badge span { background: linear-gradient(135deg, #3b82f6, #8b5cf6); color: white; padding: 6px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; }
        
        .timetable-wrapper { max-width: 1200px; margin: 0 auto; overflow-x: auto; overflow-y: visible; -webkit-overflow-scrolling: touch; scrollbar-width: thin; scrollbar-color: #cbd5e0 #f7fafc; padding: 0 15px; }
        .timetable-wrapper::-webkit-scrollbar { height: 8px; }
        .timetable-wrapper::-webkit-scrollbar-track { background: #f7fafc; border-radius: 4px; }
        .timetable-wrapper::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 4px; }
        .timetable-container { display: grid; grid-template-columns: 120px repeat(5, minmax(180px, 1fr)); min-width: 1220px; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); border: 1px solid #e5e5e5; position: relative; }
        .header { background: #1a1a1a; color: white; padding: 20px 16px; text-align: center; font-weight: 600; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.05em; border-right: 1px solid #333; }
        .header:last-child { border-right: none; }
        .time-slot { background: #f8f8f8; color: #4a4a4a; padding: 18px 12px; text-align: center; font-weight: 500; font-size: 0.85rem; border-right: 1px solid #e5e5e5; border-bottom: 1px solid #e5e5e5; display: flex; align-items: center; justify-content: center; }
        .cell { background: white; padding: 16px 12px; text-align: center; min-height: 80px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.8rem; color: #4a4a4a; border-right: 1px solid #e5e5e5; border-bottom: 1px solid #e5e5e5; transition: all 0.2s ease; cursor: default; position: relative; }
        .cell:hover { background: #f9f9f9; }
        .cell.has-class { background: #fff; border-left: 4px solid #3b82f6; font-weight: 500; }
        .cell.has-class.lab { border-left-color: #059669; background: #f0fdf4; }
        .cell.has-class.lecture { border-left-color: #3b82f6; background: #eff6ff; }
        .cell.has-class:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        .course-name { font-weight: 600; font-size: 0.85rem; color: #1a1a1a; margin-bottom: 6px; line-height: 1.2; position: relative; }
        .course-details { font-size: 0.75rem; color: #6b7280; margin-bottom: 2px; }
        .course-link { font-size: 0.7rem; color: #3b82f6; background: rgba(59, 130, 246, 0.1); padding: 4px 8px; border-radius: 6px; margin-top: 6px; font-weight: 500; transition: all 0.2s ease; }
        .cell.clickable { cursor: pointer; }
        .type-indicator { position: absolute; top: 8px; right: 8px; width: 8px; height: 8px; border-radius: 50%; background: #3b82f6; }
        .cell.lab .type-indicator { background: #059669; }
        .cell.lecture .type-indicator { background: #3b82f6; }
        
        .cell.current-class { border: 2px solid #dc2626 !important; background: linear-gradient(135deg, #fef2f2, #fee2e2) !important; animation: currentClassPulse 3s ease-in-out infinite; position: relative; z-index: 10; }
        .cell.current-class::before { content: 'LIVE'; position: absolute; top: 4px; left: 4px; background: #dc2626; color: white; font-size: 0.6rem; font-weight: 700; padding: 2px 4px; border-radius: 3px; z-index: 11; }
        @keyframes currentClassPulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4); } 50% { box-shadow: 0 0 0 8px rgba(220, 38, 38, 0.1); } }
        .cell.next-class { border: 2px solid #059669 !important; background: linear-gradient(135deg, #f0fdf4, #dcfce7) !important; position: relative; }
        .cell.next-class::before { content: 'NEXT'; position: absolute; top: 4px; left: 4px; background: #059669; color: white; font-size: 0.6rem; font-weight: 700; padding: 2px 4px; border-radius: 3px; z-index: 11; }
        .cell.completed-class { border: 2px solid #6b7280 !important; background: linear-gradient(135deg, #f9fafb, #f3f4f6) !important; opacity: 0.7; position: relative; }
        .cell.completed-class::before { content: 'DONE'; position: absolute; top: 4px; left: 4px; background: #6b7280; color: white; font-size: 0.6rem; font-weight: 700; padding: 2px 4px; border-radius: 3px; z-index: 11; }
        
        .legend { display: flex; justify-content: center; gap: 24px; margin-top: 20px; font-size: 0.8rem; color: #6b7280; }
        .legend-item { display: flex; align-items: center; gap: 6px; }
        .legend-dot { width: 8px; height: 8px; border-radius: 50%; }
        .legend-dot.lecture { background: #3b82f6; }
        .legend-dot.lab { background: #059669; }
        
        .subject-reference { max-width: 800px; margin: 30px auto; background: white; border-radius: 12px; padding: 24px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); border: 1px solid #e5e5e5; color: #1a1a1a; }
        .subject-reference h3 { margin-bottom: 16px; color: #1a1a1a; font-size: 1.1rem; font-weight: 600; }
        .subject-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .subject-table th, .subject-table td { padding: 10px 12px; text-align: left; border-bottom: 1px solid #e5e5e5; color: #1a1a1a; }
        .subject-table th { background: #f8f9fa; font-weight: 600; color: #374151; }
        .subject-table tr:last-child td { border-bottom: none; }
        .subject-table .code { font-family: 'SF Mono', Monaco, monospace; color: #3b82f6; font-weight: 500; }
        .timetable-footer { text-align: center; margin-top: 40px; color: #9ca3af; font-size: 0.75rem; }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .section-grid { grid-template-columns: repeat(3, 1fr); }
            .section-btn { padding: 16px 12px; }
            .main-title { font-size: 2rem; }
            .resource-hub-btn { padding: 14px 20px; font-size: 0.9rem; max-width: 100%; }
            .timetable-page { padding: 15px 5px; }
            .timetable-wrapper { padding: 0 10px; }
            .timetable-container { grid-template-columns: 90px repeat(5, minmax(160px, 1fr)); min-width: 990px; font-size: 0.7rem; }
            h1.page-title { font-size: 1.8rem; margin-bottom: 8px; }
            .header, .time-slot, .cell { padding: 10px 6px; min-height: 65px; }
            .header { font-size: 0.75rem; padding: 15px 8px; }
            .time-slot { font-size: 0.7rem; padding: 12px 4px; }
            .course-name { font-size: 0.75rem; margin-bottom: 4px; }
            .course-details { font-size: 0.65rem; }
            .legend { flex-direction: column; align-items: center; gap: 12px; }
            .controls { flex-direction: column; gap: 12px; }
            .today-btn, .week-btn, .download-btn { padding: 10px 20px; font-size: 0.8rem; width: 100%; max-width: 200px; }
            .current-time { font-size: 0.7rem; padding: 6px 12px; }
            .timetable-wrapper::before { content: "← Swipe to see all days →"; display: block; text-align: center; font-size: 0.65rem; color: #6b7280; padding: 6px; background: #f8f9fa; border-radius: 6px 6px 0 0; }
            .back-btn { top: 10px; left: 10px; padding: 8px 12px; font-size: 0.75rem; }
            .add-form-container { padding: 20px; margin: 0 10px; }
            .resource-card { flex-direction: column; }
            .vote-section { flex-direction: row; justify-content: flex-start; gap: 8px; }
            .tab-nav { flex-direction: column; align-items: stretch; padding: 0 10px; }
            .tab-btn { justify-content: center; }
            .resource-list { padding: 0 10px; }
        }

        @media (max-width: 480px) {
            .section-grid { grid-template-columns: repeat(2, 1fr); }
            .section-btn small { display: none; }
            .subject-filter { gap: 6px; padding: 0 10px; }
            .subject-chip { padding: 6px 12px; font-size: 0.7rem; }
            .resource-meta { gap: 6px; }
            .meta-tag { padding: 3px 8px; font-size: 0.68rem; }
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div class="landing-page" id="landing-page">
        <div class="landing-content">
            <div class="logo-text">CSE • Thapar University</div>
            <h1 class="main-title">2Q1 Timetable</h1>
            <p class="subtitle">Select your section to view schedule</p>
            <div class="semester-tag">Semester IV • Jan – May 2026</div>
            
            <div class="section-grid">
                <button class="section-btn" onclick="loadSection('2Q11')">
                    <span>2Q11</span>
                    <small>Section A</small>
                </button>
                <button class="section-btn" onclick="loadSection('2Q12')">
                    <span>2Q12</span>
                    <small>Section B</small>
                </button>
                <button class="section-btn" onclick="loadSection('2Q13')">
                    <span>2Q13</span>
                    <small>Section C</small>
                </button>
                <button class="section-btn" onclick="loadSection('2Q14')">
                    <span>2Q14</span>
                    <small>Section D</small>
                </button>
                <button class="section-btn" onclick="loadSection('2Q15')">
                    <span>2Q15</span>
                    <small>Section E</small>
                </button>
            </div>

            <!-- Resource Hub Button -->
            <button class="resource-hub-btn" onclick="openResourceHub()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                </svg>
                Community Resource Hub
                <div class="live-dot"></div>
                <span class="resource-badge" id="resource-count">Live</span>
            </button>
        </div>
        
        <div class="footer-credit">
            created by 
            <a href="https://www.instagram.com/__arun_a_k/" target="_blank">
                <svg class="insta-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                </svg>
                ARUN AK
            </a>
        </div>
    </div>

    <!-- Resource Hub Page -->
    <div class="resource-page" id="resource-page">
        <button class="back-btn" onclick="goBackFromResources()">← Back</button>
        
        <div class="resource-header">
            <h1> Community Resource Hub</h1>
            <p>Peer-reviewed study materials • Real-time updates</p>
            <div class="connection-status" id="connection-status">
                <div class="dot"></div>
                <span>Connected to Firebase</span>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-btn active" id="view-tab" onclick="switchTab('view')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
                </svg>
                Browse Resources
            </button>
            <button class="tab-btn" id="add-tab" onclick="switchTab('add')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14m-7-7h14"/>
                </svg>
                Add Resource
            </button>
        </div>

        <!-- View Tab Content -->
        <div id="view-content">
            <!-- Subject Filter -->
            <div class="subject-filter" id="subject-filter">
                <button class="subject-chip active" data-subject="all">All Subjects</button>
                <button class="subject-chip" data-subject="UCS415">DAA</button>
                <button class="subject-chip" data-subject="UCS310">DBMS</button>
                <button class="subject-chip" data-subject="UCS321">AI</button>
                <button class="subject-chip" data-subject="UCS414">CN</button>
                <button class="subject-chip" data-subject="UMA401">Prob & Stats</button>
                <button class="subject-chip" data-subject="UTA024">EDP-II</button>
                <button class="subject-chip" data-subject="UTD003">Aptitude</button>
            </div>

            <!-- Resource List -->
            <div class="resource-list" id="resource-list">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Loading resources...</p>
                </div>
            </div>
        </div>

        <!-- Add Tab Content -->
        <div id="add-content" class="hidden">
            <div class="add-form-container">
                <h2 class="form-title">➕ Add a New Resource</h2>
                
                <form id="add-resource-form">
                    <div class="form-group">
                        <label class="form-label">Resource Title <span>(e.g., "Abdul Bari - Algorithms Playlist")</span></label>
                        <input type="text" class="form-input" id="resource-title" placeholder="Enter a descriptive title" required maxlength="100">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Select Subject</label>
                        <select class="form-select" id="resource-subject" required>
                            <option value="">Choose a subject...</option>
                            <option value="UCS415">UCS415 - Design & Analysis of Algorithms</option>
                            <option value="UCS310">UCS310 - Database Management Systems</option>
                            <option value="UCS321">UCS321 - AI for Engineers</option>
                            <option value="UCS414">UCS414 - Computer Networks</option>
                            <option value="UMA401">UMA401 - Probability and Statistics</option>
                            <option value="UTA024">UTA024 - Engineering Design Project II</option>
                            <option value="UTD003">UTD003 - Aptitude Skills Building</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Platform</label>
                        <select class="form-select" id="resource-platform" required>
                            <option value="">Choose platform...</option>
                            <option value="YouTube">YouTube</option>
                            <option value="Udemy">Udemy</option>
                            <option value="Coursera">Coursera</option>
                            <option value="NPTEL">NPTEL</option>
                            <option value="GeeksforGeeks">GeeksforGeeks</option>
                            <option value="LeetCode">LeetCode</option>
                            <option value="Website">Website</option>
                            <option value="PDF/Notes">PDF/Notes</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Type of Resource</label>
                        <select class="form-select" id="resource-type" required>
                            <option value="">Choose type...</option>
                            <option value="Playlist">Video Playlist</option>
                            <option value="Single Video">Single Video</option>
                            <option value="Course">Full Course</option>
                            <option value="Notes">Notes/PDF</option>
                            <option value="Practice">Practice Problems</option>
                            <option value="Tool">Tool/Software</option>
                            <option value="Book">Book/eBook</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Resource URL <span>(required)</span></label>
                        <input type="url" class="form-input" id="resource-url" placeholder="https://..." required>
                        <div class="form-hint">Paste the direct link to the resource</div>
                        <div class="form-error hidden" id="url-error">This resource already exists! Please upvote it instead.</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Content Quality <span>(Teaching style, clarity, production)</span></label>
                        <div class="star-rating-input" id="quality-rating">
                            <button type="button" class="star-btn" data-value="1"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></button>
                            <button type="button" class="star-btn" data-value="2"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></button>
                            <button type="button" class="star-btn" data-value="3"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></button>
                            <button type="button" class="star-btn" data-value="4"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></button>
                            <button type="button" class="star-btn" data-value="5"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></button>
                        </div>
                        <div class="rating-label">Selected: <span id="quality-label">Not rated</span></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Syllabus Relevancy <span>(How well does it match our syllabus?)</span></label>
                        <div class="star-rating-input" id="relevancy-rating">
                            <button type="button" class="star-btn" data-value="1"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></button>
                            <button type="button" class="star-btn" data-value="2"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></button>
                            <button type="button" class="star-btn" data-value="3"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></button>
                            <button type="button" class="star-btn" data-value="4"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></button>
                            <button type="button" class="star-btn" data-value="5"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></button>
                        </div>
                        <div class="rating-label">Selected: <span id="relevancy-label">Not rated</span></div>
                    </div>

                    <button type="submit" class="submit-btn" id="submit-btn">Add Resource</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Timetable Page -->
    <div class="timetable-page" id="timetable-page">
        <button class="back-btn" onclick="goBack()">← Back</button>
        
        <h1 class="page-title" id="main-title">Timetable</h1>
        <div class="semester-badge"><span>📚 Semester IV • Jan - May 2026</span></div>
        
        <div class="controls">
            <button id="today-btn" class="today-btn">📅 Today's Focus</button>
            <button id="week-btn" class="week-btn">📋 Full Week</button>
            <button id="download-btn" class="download-btn">📥 Download as Image</button>
            <div id="current-time" class="current-time"></div>
        </div>
        
        <div id="today-agenda" class="today-agenda hidden">
            <h3>Today's Schedule</h3>
            <div id="agenda-content" class="agenda-content"><div class="no-classes">No classes today! 🎉</div></div>
        </div>
        
        <div class="timetable-wrapper">
            <div class="timetable-container">
                <div class="header">Time</div>
                <div class="header">Monday</div>
                <div class="header">Tuesday</div>
                <div class="header">Wednesday</div>
                <div class="header">Thursday</div>
                <div class="header">Friday</div>
                <div class="time-slot">8:00 AM</div><div class="cell" id="slot1-monday"></div><div class="cell" id="slot1-tuesday"></div><div class="cell" id="slot1-wednesday"></div><div class="cell" id="slot1-thursday"></div><div class="cell" id="slot1-friday"></div>
                <div class="time-slot">8:50 AM</div><div class="cell" id="slot2-monday"></div><div class="cell" id="slot2-tuesday"></div><div class="cell" id="slot2-wednesday"></div><div class="cell" id="slot2-thursday"></div><div class="cell" id="slot2-friday"></div>
                <div class="time-slot">9:40 AM</div><div class="cell" id="slot3-monday"></div><div class="cell" id="slot3-tuesday"></div><div class="cell" id="slot3-wednesday"></div><div class="cell" id="slot3-thursday"></div><div class="cell" id="slot3-friday"></div>
                <div class="time-slot">10:30 AM</div><div class="cell" id="slot4-monday"></div><div class="cell" id="slot4-tuesday"></div><div class="cell" id="slot4-wednesday"></div><div class="cell" id="slot4-thursday"></div><div class="cell" id="slot4-friday"></div>
                <div class="time-slot">11:20 AM</div><div class="cell" id="slot5-monday"></div><div class="cell" id="slot5-tuesday"></div><div class="cell" id="slot5-wednesday"></div><div class="cell" id="slot5-thursday"></div><div class="cell" id="slot5-friday"></div>
                <div class="time-slot">12:10 PM</div><div class="cell" id="slot6-monday"></div><div class="cell" id="slot6-tuesday"></div><div class="cell" id="slot6-wednesday"></div><div class="cell" id="slot6-thursday"></div><div class="cell" id="slot6-friday"></div>
                <div class="time-slot">1:00 PM</div><div class="cell" id="slot7-monday"></div><div class="cell" id="slot7-tuesday"></div><div class="cell" id="slot7-wednesday"></div><div class="cell" id="slot7-thursday"></div><div class="cell" id="slot7-friday"></div>
                <div class="time-slot">1:50 PM</div><div class="cell" id="slot8-monday"></div><div class="cell" id="slot8-tuesday"></div><div class="cell" id="slot8-wednesday"></div><div class="cell" id="slot8-thursday"></div><div class="cell" id="slot8-friday"></div>
                <div class="time-slot">2:40 PM</div><div class="cell" id="slot9-monday"></div><div class="cell" id="slot9-tuesday"></div><div class="cell" id="slot9-wednesday"></div><div class="cell" id="slot9-thursday"></div><div class="cell" id="slot9-friday"></div>
                <div class="time-slot">3:30 PM</div><div class="cell" id="slot10-monday"></div><div class="cell" id="slot10-tuesday"></div><div class="cell" id="slot10-wednesday"></div><div class="cell" id="slot10-thursday"></div><div class="cell" id="slot10-friday"></div>
                <div class="time-slot">4:20 PM</div><div class="cell" id="slot11-monday"></div><div class="cell" id="slot11-tuesday"></div><div class="cell" id="slot11-wednesday"></div><div class="cell" id="slot11-thursday"></div><div class="cell" id="slot11-friday"></div>
                <div class="time-slot">5:10 PM</div><div class="cell" id="slot12-monday"></div><div class="cell" id="slot12-tuesday"></div><div class="cell" id="slot12-wednesday"></div><div class="cell" id="slot12-thursday"></div><div class="cell" id="slot12-friday"></div>
                <div class="time-slot">6:00 PM</div><div class="cell" id="slot13-monday"></div><div class="cell" id="slot13-tuesday"></div><div class="cell" id="slot13-wednesday"></div><div class="cell" id="slot13-thursday"></div><div class="cell" id="slot13-friday"></div>
                <div class="time-slot">6:50 PM</div><div class="cell" id="slot14-monday"></div><div class="cell" id="slot14-tuesday"></div><div class="cell" id="slot14-wednesday"></div><div class="cell" id="slot14-thursday"></div><div class="cell" id="slot14-friday"></div>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item"><div class="legend-dot lecture"></div><span>Lecture</span></div>
            <div class="legend-item"><div class="legend-dot lab"></div><span>Lab</span></div>
        </div>
        
        <div class="subject-reference">
            <h3>📖 Subject Code Reference</h3>
            <table class="subject-table">
                <thead><tr><th>Code</th><th>Subject</th><th>Credits</th></tr></thead>
                <tbody>
                    <tr><td class="code">UCS415</td><td>Design and Analysis of Algorithms</td><td>4</td></tr>
                    <tr><td class="code">UCS310</td><td>Database Management Systems</td><td>4</td></tr>
                    <tr><td class="code">UCS321</td><td>AI for Engineers</td><td>-</td></tr>
                    <tr><td class="code">UCS414</td><td>Computer Networks</td><td>-</td></tr>
                    <tr><td class="code">UMA401</td><td>Probability and Statistics</td><td>4</td></tr>
                    <tr><td class="code">UTA024</td><td>Engineering Design Project II</td><td>3</td></tr>
                    <tr><td class="code">UTD003</td><td>Aptitude Skills Building</td><td>2</td></tr>
                </tbody>
            </table>
        </div>
        
        <div class="timetable-footer">created by arun ak • © 2026</div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span id="toast-message">Success!</span>
    </div>

    <script>
        // ==================== FIREBASE CONFIGURATION ====================
        // TODO: Replace with your Firebase project config
        const firebaseConfig = {
  apiKey: "AIzaSyBR0NEl4TPN7bGfNN49V8pxtQa7P2GTK0k",
  authDomain: "thapar-timetable-d0a12.firebaseapp.com",
  projectId: "thapar-timetable-d0a12",
  storageBucket: "thapar-timetable-d0a12.firebasestorage.app",
  messagingSenderId: "96319566329",
  appId: "1:96319566329:web:e2f7d49aebe690817f4d28",
  measurementId: "G-RE094G93NX"
};

        // Initialize Firebase
        let db, auth, currentUser = null;
        let firebaseInitialized = false;

        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            auth = firebase.auth();
            firebaseInitialized = true;
            
            // Anonymous Auth - assigns unique UID to each visitor
            auth.signInAnonymously().then((result) => {
                currentUser = result.user;
                console.log('Anonymous user:', currentUser.uid);
            }).catch((error) => {
                console.error('Auth error:', error);
            });
        } catch (e) {
            console.warn('Firebase not configured. Using demo mode.');
            firebaseInitialized = false;
        }

        // ==================== GLOBAL STATE ====================
        let allTimetableData = null;
        let timetableData = null;
        let currentSection = null;
        let todayMode = false;
        let resources = [];
        let currentFilter = 'all';
        let qualityRating = 0;
        let relevancyRating = 0;
        let unsubscribeListener = null;

        const subjectNames = {
            'UCS415': 'Design & Analysis of Algorithms',
            'UCS310': 'Database Management Systems',
            'UCS321': 'AI for Engineers',
            'UCS414': 'Computer Networks',
            'UMA401': 'Probability and Statistics',
            'UTA024': 'Engineering Design Project II',
            'UTD003': 'Aptitude Skills Building'
        };

        const timeSlots = { 'slot1': '8:00 AM', 'slot2': '8:50 AM', 'slot3': '9:40 AM', 'slot4': '10:30 AM', 'slot5': '11:20 AM', 'slot6': '12:10 PM', 'slot7': '1:00 PM', 'slot8': '1:50 PM', 'slot9': '2:40 PM', 'slot10': '3:30 PM', 'slot11': '4:20 PM', 'slot12': '5:10 PM', 'slot13': '6:00 PM', 'slot14': '6:50 PM' };

        // ==================== RESOURCE HUB - FIREBASE FUNCTIONS ====================
        
        function openResourceHub() {
            document.getElementById('landing-page').classList.add('hidden');
            document.getElementById('resource-page').classList.add('active');
            
            if (firebaseInitialized) {
                startRealtimeListener();
            } else {
                loadDemoResources();
            }
        }

        function goBackFromResources() {
            document.getElementById('landing-page').classList.remove('hidden');
            document.getElementById('resource-page').classList.remove('active');
            
            // Unsubscribe from real-time listener
            if (unsubscribeListener) {
                unsubscribeListener();
                unsubscribeListener = null;
            }
        }

        // Real-time listener for Firestore
        function startRealtimeListener() {
            const statusEl = document.getElementById('connection-status');
            
            // Build query with filters
            let query = db.collection('resources')
                .where('netScore', '>', -5) // Quality filter: hide badly rated
                .where('reportCount', '<', 3) // Safety filter: hide reported
                .orderBy('netScore', 'desc');

            unsubscribeListener = query.onSnapshot((snapshot) => {
                resources = [];
                snapshot.forEach((doc) => {
                    resources.push({ id: doc.id, ...doc.data() });
                });
                
                statusEl.classList.remove('offline');
                statusEl.querySelector('span').textContent = 'Connected • Real-time';
                
                renderResources();
            }, (error) => {
                console.error('Firestore error:', error);
                statusEl.classList.add('offline');
                statusEl.querySelector('span').textContent = 'Connection error';
                loadDemoResources();
            });
        }

        // Demo mode for when Firebase is not configured
        function loadDemoResources() {
            const statusEl = document.getElementById('connection-status');
            statusEl.classList.add('offline');
            statusEl.querySelector('span').textContent = 'Demo Mode (Configure Firebase)';
            
            resources = [
                { id: '1', title: 'Abdul Bari - Algorithms Playlist', subject: 'UCS415', platform: 'YouTube', type: 'Playlist', url: 'https://www.youtube.com/playlist?list=PLDN4rrl48XKpZkf03iYFl-O29szjTrs_O', quality: 5, relevancy: 4, upvotes: 28, downvotes: 4, netScore: 24, reportCount: 0, upvotedBy: [], downvotedBy: [], reportedBy: [] },
                { id: '2', title: 'Gate Smashers - DBMS Complete', subject: 'UCS310', platform: 'YouTube', type: 'Playlist', url: 'https://www.youtube.com/playlist?list=PLxCzCOWd7aiFAN6I8CuViBuCdJgiOkT2Y', quality: 4, relevancy: 5, upvotes: 22, downvotes: 4, netScore: 18, reportCount: 0, upvotedBy: [], downvotedBy: [], reportedBy: [] },
                { id: '3', title: 'Neso Academy - Computer Networks', subject: 'UCS414', platform: 'YouTube', type: 'Playlist', url: 'https://www.youtube.com/playlist?list=PLBlnK6fEyqRgMCUAG0XRw78UA8qnv6jEx', quality: 5, relevancy: 4, upvotes: 19, downvotes: 4, netScore: 15, reportCount: 0, upvotedBy: [], downvotedBy: [], reportedBy: [] },
                { id: '4', title: 'NPTEL - Probability & Statistics', subject: 'UMA401', platform: 'NPTEL', type: 'Course', url: 'https://nptel.ac.in/courses/111105090', quality: 5, relevancy: 5, upvotes: 16, downvotes: 4, netScore: 12, reportCount: 0, upvotedBy: [], downvotedBy: [], reportedBy: [] },
                { id: '5', title: 'Sentdex - AI/ML with Python', subject: 'UCS321', platform: 'YouTube', type: 'Playlist', url: 'https://www.youtube.com/playlist?list=PLQVvvaa0QuDfKTOs3Keq_kaG2P55YRn5v', quality: 4, relevancy: 3, upvotes: 12, downvotes: 3, netScore: 9, reportCount: 0, upvotedBy: [], downvotedBy: [], reportedBy: [] }
            ];
            renderResources();
        }

        function switchTab(tab) {
            document.getElementById('view-tab').classList.toggle('active', tab === 'view');
            document.getElementById('add-tab').classList.toggle('active', tab === 'add');
            document.getElementById('view-content').classList.toggle('hidden', tab !== 'view');
            document.getElementById('add-content').classList.toggle('hidden', tab !== 'add');
        }

        function renderResources() {
            const list = document.getElementById('resource-list');
            let filtered = resources;
            
            if (currentFilter !== 'all') {
                filtered = resources.filter(r => r.subject === currentFilter);
            }

            // Sort by netScore (descending)
            filtered.sort((a, b) => (b.netScore || 0) - (a.netScore || 0));

            if (filtered.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                        <h3>No resources yet</h3>
                        <p>Be the first to add a resource for this subject!</p>
                    </div>
                `;
                return;
            }

            const uid = currentUser?.uid || 'demo-user';
            
            list.innerHTML = filtered.map(r => {
                const hasUpvoted = r.upvotedBy?.includes(uid);
                const hasDownvoted = r.downvotedBy?.includes(uid);
                const hasReported = r.reportedBy?.includes(uid);
                const scoreClass = r.netScore > 0 ? 'positive' : r.netScore < 0 ? 'negative' : '';
                
                return `
                <div class="resource-card ${hasReported ? 'reported' : ''}">
                    <div class="vote-section">
                        <button class="vote-btn upvote ${hasUpvoted ? 'active' : ''}" onclick="vote('${r.id}', 'up')" title="This helped me">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M18 15l-6-6-6 6"/>
                            </svg>
                        </button>
                        <span class="vote-count ${scoreClass}">${r.netScore || 0}</span>
                        <button class="vote-btn downvote ${hasDownvoted ? 'active' : ''}" onclick="vote('${r.id}', 'down')" title="Not helpful">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M6 9l6 6 6-6"/>
                            </svg>
                        </button>
                    </div>
                    <div class="resource-content">
                        <div class="resource-title-row">
                            <div class="resource-title">
                                ${r.url ? `<a href="${r.url}" target="_blank">${r.title}</a>` : r.title}
                                ${r.url ? `<svg class="external-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6M15 3h6v6M10 14L21 3"/></svg>` : ''}
                            </div>
                            <button class="report-btn ${hasReported ? 'reported' : ''}" onclick="reportResource('${r.id}')" title="Report as spam/broken">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"/>
                                </svg>
                            </button>
                        </div>
                        <div class="resource-meta">
                            <span class="meta-tag platform">${r.platform}</span>
                            <span class="meta-tag type">${r.type}</span>
                            <span class="meta-tag">Quality: ${renderStars(r.quality)}</span>
                            <span class="meta-tag">Relevancy: ${renderStars(r.relevancy)}</span>
                        </div>
                        <div class="resource-subject">${subjectNames[r.subject] || r.subject}</div>
                    </div>
                </div>
            `}).join('');
        }

        function renderStars(rating) {
            let html = '<span class="rating-stars">';
            for (let i = 1; i <= 5; i++) {
                html += `<svg viewBox="0 0 24 24" class="${i <= rating ? 'filled' : 'empty'}" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`;
            }
            html += '</span>';
            return html;
        }

        // Vote function with "Vote Rigging Shield"
        async function vote(resourceId, voteType) {
            const uid = currentUser?.uid;
            
            if (!firebaseInitialized) {
                // Demo mode voting
                const resource = resources.find(r => r.id === resourceId);
                if (!resource) return;
                
                if (voteType === 'up') {
                    if (resource.upvotedBy?.includes('demo-user')) {
                        resource.upvotes--;
                        resource.upvotedBy = resource.upvotedBy.filter(u => u !== 'demo-user');
                    } else {
                        resource.upvotes++;
                        resource.upvotedBy = [...(resource.upvotedBy || []), 'demo-user'];
                        // Remove downvote if exists
                        if (resource.downvotedBy?.includes('demo-user')) {
                            resource.downvotes--;
                            resource.downvotedBy = resource.downvotedBy.filter(u => u !== 'demo-user');
                        }
                    }
                } else {
                    if (resource.downvotedBy?.includes('demo-user')) {
                        resource.downvotes--;
                        resource.downvotedBy = resource.downvotedBy.filter(u => u !== 'demo-user');
                    } else {
                        resource.downvotes++;
                        resource.downvotedBy = [...(resource.downvotedBy || []), 'demo-user'];
                        // Remove upvote if exists
                        if (resource.upvotedBy?.includes('demo-user')) {
                            resource.upvotes--;
                            resource.upvotedBy = resource.upvotedBy.filter(u => u !== 'demo-user');
                        }
                    }
                }
                resource.netScore = resource.upvotes - resource.downvotes;
                renderResources();
                showToast(voteType === 'up' ? '👍 Upvoted!' : '👎 Downvoted', 'success');
                return;
            }
            
            if (!uid) {
                showToast('⏳ Please wait, authenticating...', 'warning');
                return;
            }

            const docRef = db.collection('resources').doc(resourceId);
            
            try {
                await db.runTransaction(async (transaction) => {
                    const doc = await transaction.get(docRef);
                    if (!doc.exists) throw new Error('Resource not found');
                    
                    const data = doc.data();
                    let upvotedBy = data.upvotedBy || [];
                    let downvotedBy = data.downvotedBy || [];
                    let upvotes = data.upvotes || 0;
                    let downvotes = data.downvotes || 0;
                    
                    if (voteType === 'up') {
                        if (upvotedBy.includes(uid)) {
                            // Remove upvote
                            upvotedBy = upvotedBy.filter(u => u !== uid);
                            upvotes--;
                        } else {
                            // Add upvote
                            upvotedBy.push(uid);
                            upvotes++;
                            // Remove downvote if exists
                            if (downvotedBy.includes(uid)) {
                                downvotedBy = downvotedBy.filter(u => u !== uid);
                                downvotes--;
                            }
                        }
                    } else {
                        if (downvotedBy.includes(uid)) {
                            // Remove downvote
                            downvotedBy = downvotedBy.filter(u => u !== uid);
                            downvotes--;
                        } else {
                            // Add downvote
                            downvotedBy.push(uid);
                            downvotes++;
                            // Remove upvote if exists
                            if (upvotedBy.includes(uid)) {
                                upvotedBy = upvotedBy.filter(u => u !== uid);
                                upvotes--;
                            }
                        }
                    }
                    
                    transaction.update(docRef, {
                        upvotedBy,
                        downvotedBy,
                        upvotes,
                        downvotes,
                        netScore: upvotes - downvotes
                    });
                });
                
                showToast(voteType === 'up' ? '👍 Vote recorded!' : '👎 Vote recorded!', 'success');
            } catch (error) {
                console.error('Vote error:', error);
                showToast('❌ Failed to vote. Try again.', 'error');
            }
        }

        // Report function with "Safety Shield"
        async function reportResource(resourceId) {
            const uid = currentUser?.uid;
            
            if (!firebaseInitialized) {
                showToast('🚩 Reported (Demo mode)', 'warning');
                return;
            }
            
            if (!uid) {
                showToast('⏳ Please wait, authenticating...', 'warning');
                return;
            }

            const docRef = db.collection('resources').doc(resourceId);
            
            try {
                await db.runTransaction(async (transaction) => {
                    const doc = await transaction.get(docRef);
                    if (!doc.exists) throw new Error('Resource not found');
                    
                    const data = doc.data();
                    let reportedBy = data.reportedBy || [];
                    
                    if (reportedBy.includes(uid)) {
                        showToast('⚠️ You already reported this', 'warning');
                        return;
                    }
                    
                    reportedBy.push(uid);
                    
                    transaction.update(docRef, {
                        reportedBy,
                        reportCount: reportedBy.length
                    });
                });
                
                showToast('🚩 Reported. Thanks for keeping the hub clean!', 'success');
            } catch (error) {
                console.error('Report error:', error);
                showToast('❌ Failed to report. Try again.', 'error');
            }
        }

        // Subject filter handlers
        document.getElementById('subject-filter').addEventListener('click', (e) => {
            if (e.target.classList.contains('subject-chip')) {
                document.querySelectorAll('.subject-chip').forEach(c => c.classList.remove('active'));
                e.target.classList.add('active');
                currentFilter = e.target.dataset.subject;
                renderResources();
            }
        });

        // Star rating handlers
        function setupStarRating(containerId, labelId, setRating) {
            const container = document.getElementById(containerId);
            const label = document.getElementById(labelId);
            const stars = container.querySelectorAll('.star-btn');

            stars.forEach(star => {
                star.addEventListener('click', (e) => {
                    e.preventDefault();
                    const value = parseInt(star.dataset.value);
                    setRating(value);
                    
                    stars.forEach((s, i) => {
                        s.classList.toggle('active', i < value);
                    });

                    const labels = ['Poor', 'Fair', 'Good', 'Very Good', 'Excellent'];
                    label.textContent = `${value}/5 - ${labels[value - 1]}`;
                });
            });
        }

        setupStarRating('quality-rating', 'quality-label', (v) => qualityRating = v);
        setupStarRating('relevancy-rating', 'relevancy-label', (v) => relevancyRating = v);

        // Check for duplicate URL (The "Duplicate Shield")
        async function checkDuplicateURL(url, subject) {
            if (!firebaseInitialized) return false;
            
            const normalizedURL = normalizeURL(url);
            const snapshot = await db.collection('resources')
                .where('normalizedURL', '==', normalizedURL)
                .get();
            
            return !snapshot.empty;
        }

        function normalizeURL(url) {
    try {
        const urlObj = new URL(url);
        
        // 1. Strip 'www.' AND 'm.' (mobile) from the start of the domain
        let hostname = urlObj.hostname.replace(/^(www\.|m\.)/, '');
        
        // 2. Remove trailing slash from path
        let path = urlObj.pathname.replace(/\/$/, '');
        
        // 3. Combine: Host + Path + Query Params (to catch ?v=ID)
        let normalized = hostname + path + urlObj.search;
        
        return normalized.toLowerCase();
    } catch {
        return url.toLowerCase();
    }
}

        // Form submission with all shields
        document.getElementById('add-resource-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submit-btn');
            const urlInput = document.getElementById('resource-url');
            const urlError = document.getElementById('url-error');
            
            const title = document.getElementById('resource-title').value.trim();
            const subject = document.getElementById('resource-subject').value;
            const platform = document.getElementById('resource-platform').value;
            const type = document.getElementById('resource-type').value;
            const url = urlInput.value.trim();

            // Validation
            if (!title || !subject || !platform || !type || !url) {
                showToast('❌ Please fill all required fields', 'error');
                return;
            }

            if (qualityRating === 0 || relevancyRating === 0) {
                showToast('❌ Please rate quality and relevancy', 'error');
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = '⏳ Checking...';

            // Check for duplicate (Duplicate Shield)
            if (firebaseInitialized) {
                const isDuplicate = await checkDuplicateURL(url, subject);
                if (isDuplicate) {
                    urlInput.classList.add('error');
                    urlError.classList.remove('hidden');
                    submitBtn.disabled = false;
                    submitBtn.textContent = '🚀 Add Resource';
                    showToast('⚠️ This resource already exists! Upvote it instead.', 'warning');
                    return;
                }
            }

            urlInput.classList.remove('error');
            urlError.classList.add('hidden');

            const uid = currentUser?.uid || 'demo-user';
            
            const newResource = {
                title,
                subject,
                platform,
                type,
                url,
                normalizedURL: normalizeURL(url),
                quality: qualityRating,
                relevancy: relevancyRating,
                upvotes: 1,
                downvotes: 0,
                netScore: 1,
                reportCount: 0,
                upvotedBy: [uid],
                downvotedBy: [],
                reportedBy: [],
                addedBy: uid,
                addedAt: firebase?.firestore?.FieldValue?.serverTimestamp() || new Date().toISOString()
            };

            try {
                if (firebaseInitialized) {
                    await db.collection('resources').add(newResource);
                } else {
                    // Demo mode
                    newResource.id = Date.now().toString();
                    resources.push(newResource);
                }
                
                // Reset form
                e.target.reset();
                qualityRating = 0;
                relevancyRating = 0;
                document.querySelectorAll('.star-btn').forEach(s => s.classList.remove('active'));
                document.getElementById('quality-label').textContent = 'Not rated';
                document.getElementById('relevancy-label').textContent = 'Not rated';

                showToast('✅ Resource added successfully!', 'success');
                switchTab('view');
                
                if (!firebaseInitialized) renderResources();
            } catch (error) {
                console.error('Add error:', error);
                showToast('❌ Failed to add resource. Try again.', 'error');
            }

            submitBtn.disabled = false;
            submitBtn.textContent = '🚀 Add Resource';
        });

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // ==================== TIMETABLE FUNCTIONS ====================
        
        fetch('2q1_timetable.json')
            .then(response => response.json())
            .then(data => { allTimetableData = data; })
            .catch(error => console.error('Error loading timetable:', error));

        function loadSection(section) {
            if (!allTimetableData) {
                alert('Data is still loading. Please try again.');
                return;
            }
            
            currentSection = section;
            timetableData = allTimetableData[section];
            
            document.getElementById('main-title').textContent = `${section} Timetable`;
            document.title = `${section} Timetable - Semester IV`;
            
            document.getElementById('landing-page').classList.add('hidden');
            document.getElementById('timetable-page').classList.add('active');
            
            clearTimetable();
            populateTimetable(timetableData);
            initializeTodayMode();
            
            document.getElementById('week-btn').classList.add('active');
        }

        function goBack() {
            document.getElementById('landing-page').classList.remove('hidden');
            document.getElementById('timetable-page').classList.remove('active');
            todayMode = false;
            document.getElementById('today-btn').classList.remove('active');
            document.getElementById('week-btn').classList.remove('active');
            document.getElementById('today-agenda').classList.add('hidden');
            document.querySelector('.timetable-container').classList.remove('today-mode');
            document.querySelectorAll('.today-column').forEach(el => el.classList.remove('today-column'));
        }

        function clearTimetable() {
            ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'].forEach(day => {
                for (let slot = 1; slot <= 14; slot++) {
                    const cell = document.getElementById(`slot${slot}-${day}`);
                    if (cell) { cell.innerHTML = ''; cell.className = 'cell'; cell.style.cursor = 'default'; cell.onclick = null; }
                }
            });
        }

        function populateTimetable(classData) {
            ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'].forEach(day => {
                const dayData = classData[day];
                for (let slot = 1; slot <= 14; slot++) {
                    const slotKey = `slot${slot}`;
                    const cell = document.getElementById(`${slotKey}-${day}`);
                    if (cell && dayData[slotKey]) {
                        const courseData = dayData[slotKey];
                        const courseType = courseData.Course.toLowerCase().includes('lab') ? 'lab' : 'lecture';
                        cell.innerHTML = `<div class="course-name">${courseData.Course}</div><div class="course-details">${courseData.Room}</div><div class="course-details">${courseData.Instructor}</div>${courseData.link ? '<div class="course-link">🔗 Click to Join</div>' : ''}<div class="type-indicator"></div>`;
                        cell.classList.add('has-class', courseType);
                        if (courseData.link) { cell.classList.add('clickable'); cell.style.cursor = 'pointer'; cell.onclick = () => window.open(courseData.link, '_blank'); }
                    }
                }
            });
        }

        function initializeTodayMode() {
            const currentTimeEl = document.getElementById('current-time');
            function updateCurrentTime() {
                const now = new Date();
                currentTimeEl.textContent = `${now.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' })} • ${now.toLocaleTimeString('en-US', { hour12: true, hour: 'numeric', minute: '2-digit', second: '2-digit' })}`;
                const currentDay = getCurrentDay();
                if (currentDay && todayMode) updateClassHighlights(currentDay, now);
            }
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
        }

        function getSlotTimeRange(slot) {
            const ranges = { 1: {start:480,end:530}, 2: {start:530,end:580}, 3: {start:580,end:630}, 4: {start:630,end:680}, 5: {start:680,end:730}, 6: {start:730,end:780}, 7: {start:780,end:830}, 8: {start:830,end:880}, 9: {start:880,end:930}, 10: {start:930,end:980}, 11: {start:980,end:1030}, 12: {start:1030,end:1080}, 13: {start:1080,end:1130}, 14: {start:1130,end:1180} };
            return ranges[slot] || {start:0,end:0};
        }

        function updateClassHighlights(day, now) {
            document.querySelectorAll('.current-class, .next-class, .completed-class').forEach(c => { c.classList.remove('current-class', 'next-class', 'completed-class'); });
            const currentTime = now.getHours() * 60 + now.getMinutes();
            const dayData = timetableData[day];
            if (!dayData) return;
            let nextFound = false;
            for (let slot = 1; slot <= 14; slot++) {
                if (dayData[`slot${slot}`]) {
                    const range = getSlotTimeRange(slot);
                    const cell = document.getElementById(`slot${slot}-${day}`);
                    if (currentTime >= range.start && currentTime <= range.end) cell?.classList.add('current-class');
                    else if (currentTime > range.end) cell?.classList.add('completed-class');
                    else if (!nextFound) { cell?.classList.add('next-class'); nextFound = true; }
                }
            }
        }

        function activateTodayMode() {
            todayMode = true;
            document.getElementById('today-btn').classList.add('active');
            document.getElementById('week-btn').classList.remove('active');
            document.getElementById('today-agenda').classList.remove('hidden');
            const today = getCurrentDay();
            if (today) {
                document.querySelector('.timetable-container').classList.add('today-mode');
                const dayIndex = ['monday','tuesday','wednesday','thursday','friday'].indexOf(today);
                document.querySelectorAll('.header')[dayIndex + 1]?.classList.add('today-column');
                for (let slot = 1; slot <= 14; slot++) document.getElementById(`slot${slot}-${today}`)?.classList.add('today-column');
                generateTodayAgenda(today);
                updateClassHighlights(today, new Date());
            }
        }

        function deactivateTodayMode() {
            todayMode = false;
            document.getElementById('today-btn').classList.remove('active');
            document.getElementById('week-btn').classList.add('active');
            document.getElementById('today-agenda').classList.add('hidden');
            document.querySelector('.timetable-container').classList.remove('today-mode');
            document.querySelectorAll('.today-column').forEach(el => el.classList.remove('today-column'));
            document.querySelectorAll('.current-class, .next-class, .completed-class').forEach(c => { c.classList.remove('current-class', 'next-class', 'completed-class'); });
        }

        function getCurrentDay() {
            const days = ['sunday','monday','tuesday','wednesday','thursday','friday','saturday'];
            const d = days[new Date().getDay()];
            return ['monday','tuesday','wednesday','thursday','friday'].includes(d) ? d : null;
        }

        function generateTodayAgenda(day) {
            const content = document.getElementById('agenda-content');
            const dayData = timetableData[day];
            if (!dayData) { content.innerHTML = '<div class="no-classes">No data available</div>'; return; }
            const classes = [];
            for (let slot = 1; slot <= 14; slot++) if (dayData[`slot${slot}`]) classes.push({ slot, time: timeSlots[`slot${slot}`], ...dayData[`slot${slot}`] });
            if (!classes.length) { content.innerHTML = '<div class="no-classes">No classes today! 🎉</div>'; return; }
            const now = new Date(), currentTime = now.getHours() * 60 + now.getMinutes();
            let nextFound = false, html = '';
            classes.forEach(c => {
                const range = getSlotTimeRange(c.slot);
                let status = 'upcoming', statusText = 'Upcoming';
                if (currentTime >= range.start && currentTime <= range.end) { status = 'current'; statusText = 'LIVE NOW'; }
                else if (currentTime > range.end) { status = 'completed'; statusText = 'Completed'; }
                else if (!nextFound) { status = 'next'; const mins = range.start - currentTime; statusText = mins > 60 ? `Next • ${Math.floor(mins/60)}h ${mins%60}m` : `Next • ${mins}min`; nextFound = true; }
                const type = c.Course.toLowerCase().includes('lab') ? 'lab' : 'lecture';
                html += `<div class="agenda-item ${status} ${type}"><div class="agenda-time">${c.time}</div><div class="agenda-details"><div class="agenda-course">${c.Course}</div><div class="agenda-meta">${c.Room} • ${c.Instructor}</div></div><div class="agenda-status ${status}">${statusText}</div></div>`;
            });
            content.innerHTML = html;
        }

        // Event listeners
        document.getElementById('today-btn').addEventListener('click', activateTodayMode);
        document.getElementById('week-btn').addEventListener('click', deactivateTodayMode);
        
        document.getElementById('download-btn').addEventListener('click', async () => {
            const btn = document.getElementById('download-btn'), origText = btn.innerHTML;
            btn.innerHTML = '⏳ Generating...'; btn.classList.add('downloading');
            try {
                const wrapper = document.createElement('div');
                wrapper.style.cssText = 'position:absolute;left:-9999px;top:0;background:#fafafa;padding:30px;';
                document.body.appendChild(wrapper);
                
                const title = document.createElement('h1');
                title.textContent = document.getElementById('main-title').textContent;
                title.style.cssText = 'text-align:center;color:#1a1a1a;font-size:2.5rem;font-weight:600;margin-bottom:10px;';
                wrapper.appendChild(title);
                
                const badge = document.querySelector('.semester-badge').cloneNode(true);
                wrapper.appendChild(badge);
                
                const timetable = document.querySelector('.timetable-container').cloneNode(true);
                timetable.style.cssText = 'margin:20px 0;min-width:auto;width:1200px;';
                timetable.querySelectorAll('.current-class,.next-class,.completed-class').forEach(c => c.classList.remove('current-class','next-class','completed-class'));
                timetable.classList.remove('today-mode');
                timetable.querySelectorAll('.today-column').forEach(c => c.classList.remove('today-column'));
                wrapper.appendChild(timetable);
                
                const legend = document.querySelector('.legend').cloneNode(true);
                legend.style.cssText = 'display:flex;justify-content:center;gap:24px;margin-top:20px;font-size:0.8rem;color:#6b7280;';
                wrapper.appendChild(legend);
                
                const credit = document.createElement('div');
                credit.style.cssText = 'text-align:center;margin-top:20px;color:#9ca3af;font-size:0.8rem;';
                credit.innerHTML = `${currentSection} Timetable • Semester IV • Jan-May 2026 • created by arun ak`;
                wrapper.appendChild(credit);
                
                const canvas = await html2canvas(wrapper, { scale: 2, backgroundColor: '#fafafa', logging: false, width: 1260, windowWidth: 1260 });
                document.body.removeChild(wrapper);
                
                const link = document.createElement('a');
                link.download = `${currentSection}_Timetable_Sem4.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                btn.innerHTML = '✅ Downloaded!';
                setTimeout(() => { btn.innerHTML = origText; btn.classList.remove('downloading'); }, 2000);
            } catch (e) {
                console.error(e);
                btn.innerHTML = '❌ Error';
                setTimeout(() => { btn.innerHTML = origText; btn.classList.remove('downloading'); }, 2000);
            }
        });
    </script>
</body>
</html>
